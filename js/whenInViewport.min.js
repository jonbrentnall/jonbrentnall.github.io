!function(e,t){"function"==typeof define&&define.amd?define([],t):"object"==typeof module&&module.exports?module.exports=t():e.WhenInViewport=t()}(this,function(){var t,n;function o(e,t,n){f.setup(),this.registryItem=l.addItem(e,"function"==typeof t?u(n||{},{callback:t}):t),l.processItem(this.registryItem)}function i(){return"innerHeight"in window?window.innerHeight:document.documentElement.offsetHeight}function r(){return"pageYOffset"in window?window.pageYOffset:document.documentElement.scrollTop||document.body.scrollTop}function s(e){return e.getBoundingClientRect().top+r()}function c(e,t,n){for(var i in e)if(e.hasOwnProperty(i)&&!1===t.call(n,e[i],i))break}function u(n){for(var e=1;e<arguments.length;e++)c(arguments[e],function(e,t){n[t]=e});return n}o.prototype.stopListening=function(){l.removeItem(this.registryItem),f.removeIfStoreEmpty()},o.defaults={threshold:0,context:null},u(o,{setRateLimiter:function(e,t){return f.rateLimiter=e,t&&(f.rateLimitDelay=t),this},checkAll:function(){return n=r(),t=i(),l.adjustPositions(l.processItem),f.removeIfStoreEmpty(),this},destroy:function(){return l.store={},f.remove(),delete f.scrollHandler,delete f.resizeHandler,this},registerAsJqueryPlugin:function(r){return r.fn.whenInViewport=function(e,t){function n(t){return function(e){t.call(this,r(e))}}var i;return i="function"==typeof e?r.extend({},t,{callback:n(e)}):r.extend(e,{callback:n(e.callback)}),this.each(function(){i.setupOnce&&r.data(this,"whenInViewport")||r.data(this,"whenInViewport",new o(this,i))})},this}});var l={store:{},counter:0,addItem:function(e,t){var n="whenInViewport"+ ++this.counter,i=u({},o.defaults,t,{storeKey:n,element:e,topOffset:s(e)});return this.store[n]=i},adjustPositions:function(t){c(this.store,function(e){e.topOffset=s(e.element),t&&t.call(l,e)})},processAll:function(){c(this.store,this.processItem,this)},processItem:function(e){n+t>=e.topOffset-e.threshold&&(this.removeItem(e),e.callback.call(e.context||window,e.element))},removeItem:function(e){delete this.store[e.storeKey]},isEmpty:function(){var e=!0;return c(this.store,function(){return e=!1}),e}},f={setuped:!1,rateLimiter:function(e,t){return e},rateLimitDelay:100,on:function(e,t){return window.addEventListener?window.addEventListener(e,t,!1):window.attachEvent&&window.attachEvent(e,t),this},off:function(e,t){return window.removeEventListener?window.removeEventListener(e,t,!1):window.detachEvent&&window.detachEvent("on"+e,t),this},setup:function(){var e=this;this.setuped||(n=r(),t=i(),this.scrollHandler=this.scrollHandler||this.rateLimiter(function(){n=r(),l.processAll(),e.removeIfStoreEmpty()},this.rateLimitDelay),this.resizeHandler=this.resizeHandler||this.rateLimiter(function(){t=i(),l.adjustPositions(l.processItem),e.removeIfStoreEmpty()},this.rateLimitDelay),this.on("scroll",this.scrollHandler).on("resize",this.resizeHandler),this.setuped=!0)},removeIfStoreEmpty:function(){l.isEmpty()&&this.remove()},remove:function(){this.setuped&&(this.off("scroll",this.scrollHandler).off("resize",this.resizeHandler),this.setuped=!1)}},e=window.jQuery||window.$;return e&&o.registerAsJqueryPlugin(e),o});